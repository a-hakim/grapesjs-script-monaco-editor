<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>GrapesJS Script Editor with Monaco Editor</title>
    <link href="https://unpkg.com/grapesjs/dist/css/grapes.min.css" rel="stylesheet">
    <script src="https://unpkg.com/grapesjs"></script>
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
      }
    </style>
  </head>
  <body>

    <div id="gjs" style="height:0px; overflow:hidden">
      <div style="margin:100px 100px 25px; padding:25px; font:caption">
        <h2>GrapesJS Script Editor with Monaco Editor</h2>
        <p>This plugin now automatically loads Monaco Editor without requiring separate initialization.</p>
        <ul>
          <li>No need to manually load Monaco Editor scripts</li>
          <li>Fully integrated Monaco Editor initialization</li>
          <li>Automatic language detection and syntax highlighting</li>
          <li>Configurable Monaco Editor options</li>
          <li>JavaScript validation with syntax error highlighting</li>
        </ul>
        <p>Select any component and use the script icon in the toolbar to add JavaScript code!</p>
      </div>
    </div>

    <script type="text/javascript">
      window.onload = () => {
        // GrapesJS initialization - Monaco Editor loads automatically!
        window.editor = grapesjs.init({
          height: '100%',
          showOffsets: true,
          allowScripts: true,
          noticeOnUnload: false,
          storageManager: false,
          container: '#gjs',
          fromElement: true,

          plugins: ['grapesjs-script-monaco-editor'],
          pluginsOpts: {
            'grapesjs-script-monaco-editor': {
              // Monaco Editor configuration
              monacoOptions: {
                theme: 'vs-dark',
                language: 'javascript',
                readOnly: false,
                minimap: { enabled: false },
                lineNumbers: 'on',
                wordWrap: 'on',
                fontSize: 14,
                tabSize: 2,
                automaticLayout: true,
                scrollBeyondLastLine: false,
                folding: true
              },
              // Monaco Loader configuration (optional)
              monacoLoaderOptions: {
                version: '0.54.0'  // Specify Monaco Editor version
              },
              // Plugin UI configuration
              modalTitle: 'Script Editor',
              buttonLabel: 'Save Script',
              starter: 'let el = this;\n// Add your JavaScript code here',
              // Component types to allow script editing
              scriptTypesSupport: ['default', 'wrapper', 'text', 'textnode', 'image', 'video', 'svg'],
              onRun: () => console.log('Script validation passed'),
              onError: (err) => console.error('Script validation failed:', err)
            }
          }
        });

        // Listen for Monaco loading events (optional)
        window.editor.on('monaco:load-error', (error) => {
          console.error('Monaco Editor failed to load:', error);
          alert('Failed to load Monaco Editor. Please check your internet connection.');
        });
      };
    </script>
  </body>
</html>